<!-- 🛡️ GUARDRAIL -->

# コードの清潔さ（保守の憲法）

## @what / @why / @failure

```
@what  未使用のコード（ファイル、export、依存関係）を検査
@why   デッドコードを排除し、コードベースを軽量かつ理解しやすく保つため
@failure  Knipエラーとなり、CIが失敗する（または警告が出る）
```

---

## ルール一覧

### 1. 未使用ファイルの禁止 (Unused Files)

プロジェクト内でimportされていないファイルを禁止する。

**理由**: 不要なファイルは認知負荷を高め、検索ノイズになる。

### 2. 未使用Exportの禁止 (Unused Exports)

exportされているが、どこからもimportされていない関数や変数を禁止する。

**理由**: 公開APIでない限り、使われていない機能はYAGNI原則に基づき削除すべき。

### 3. 未使用依存関係の禁止 (Unused Dependencies)

`package.json` にあるが、コード内でimportされていないパッケージを検出する。

**理由**: インストール時間とディスク容量の無駄であり、セキュリティリスクにもなる。

---

## 例外と理由

以下のパターンでは、ルールの一部を意図的に緩和している。

### 1. エントリーポイント

- **対象**: `main.ts` 等
- **緩和ルール**: 未使用ファイル/Export検出
- **理由**: アプリケーションの起動点であり、どこからもimportされないのが正常なため。

### 2. 設定ファイル

- **対象**: `*.config.js`, `*.config.ts`
- **緩和ルール**: 未使用ファイル/Export検出
- **理由**: ツールによって自動的に読み込まれるため。

---

## 実装

### ルールファイル

**ソースオブトゥルース**: [`cleanliness.rules.js`](../rules/cleanliness.rules.js)

### 使用方法

```bash
npm run lint:knip
```

### 設定ファイル

`knip.config.js` がルールファイルをimportして使用。

---

## 違反時の対応

1. `npm run lint:knip` でエラーを確認
2. 本当に使っていないなら削除する
3. 使っているはずなら、Knipの設定（エントリーポイント等）を見直す

---

## 関連

- [Guards README](../../README.md)
