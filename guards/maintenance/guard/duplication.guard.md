<!-- 🛡️ GUARDRAIL -->

# コード重複の禁止（保守の憲法）

## @what / @why / @failure

```
@what  コードの重複（コピペコード）を検出
@why   コードの重複は保守性を下げ、バグ修正の漏れ（1箇所直してもう1箇所忘れる）を招くため
@failure  一定以上の重複率または重複行数でエラーとなり、CIが失敗する
```

---

## ルール一覧

### 1. 重複コードの禁止

重複ブロックを検出する。

**閾値**:
- トークン数: 100以上
- 重複率: 全体の5%以下（厳しめ）

**理由**: DRY (Don't Repeat Yourself) 原則の遵守。

---

## 例外と理由

以下のパターンでは、重複検出を緩和・除外している。

### 1. テストファイル

- **対象**: `**/*.spec.ts`
- **理由**: テストコードはセットアップなどで意図的に重複することが多く、DRYにしすぎると可読性が下がるため（DAMP原則）。

### 2. 資産ファイル

- **対象**: `assets/**`, `dist/**`
- **理由**: 生成物や静的ファイルは対象外。

---

## 実装

### ルールファイル

**ソースオブトゥルース**: [`duplication.rules.json`](../rules/duplication.rules.json)

### 使用方法

```bash
npm run lint:duplication
```

---

## 違反時の対応

1. 重複箇所を確認
2. 共通ロジックを関数やコンポーネント、サービスとして切り出す
3. 切り出した共通部分を両方から参照する

---

## 関連

- [Guards README](../../README.md)
